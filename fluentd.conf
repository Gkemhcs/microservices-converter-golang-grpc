<system>
  log_level debug
</system>

# Single source for all log files
<source>
  @type tail
  path /root/logs/*.log
  pos_file /var/log/fluentd-logs.pos
  tag app_logs
  format json
  <parse>
    @type json
  </parse>
</source>

# Filter to add a "service" field based on the filename
<filter app_logs>
  @type record_transformer
  enable_ruby true
  <record>
    service ${File.basename(record["path"], ".log")}
  </record>
</filter>

<match app_logs>
  @type elasticsearch
  host "#{ENV['FLUENT_ELASTICSEARCH_HOST']}"
  port "#{ENV['FLUENT_ELASTICSEARCH_PORT']}"
  scheme "#{ENV['FLUENT_ELASTICSEARCH_SCHEME']}"
  logstash_format true
  logstash_prefix microservices-converter-demo
  flush_interval 5s
</match>
